<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to My Page</title>
    <style>
        /* 잡스의 미니멀리즘 철학 반영 */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f4f4f4;
        }

        h1 {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 0.5em;
            color: #333;
        }

        p {
            font-size: 1.25em;
            color: #555;
            margin-top: 0;
        }

        #visitorCount {
            font-weight: bold;
            color: #007aff;
            font-size: 2em;
            display: inline-block;
            transition: transform 0.3s ease-in-out;
        }

        /* 방문자 카운트가 증가할 때 애니메이션 */
        .count-up {
            transform: scale(1.2);
        }

        .container {
            text-align: center;
            background: white;
            padding: 2em;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Welcome to My Page</h1>
        <p>You are visitor number: <span id="visitorCount">Loading...</span></p>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        // Import the functions you need from the SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-analytics.js";
        import { getFirestore, doc, runTransaction } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCe86NkQI1UaPK0pr0XqpvbBUBybTQkOQ0",
            authDomain: "count-3ce26.firebaseapp.com",
            projectId: "count-3ce26",
            storageBucket: "count-3ce26.appspot.com",
            messagingSenderId: "60996349215",
            appId: "1:60996349215:web:395dc0692334342670142a",
            measurementId: "G-2QFCDW8HNW"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);

        // 방문자 카운터 업데이트 함수
        async function updateVisitorCount() {
            const counterRef = doc(db, 'counters', 'visitorCount');
            try {
                await runTransaction(db, async (transaction) => {
                    const docSnap = await transaction.get(counterRef);
                    if (!docSnap.exists()) {
                        // 방문자 카운터 생성
                        transaction.set(counterRef, { count: 1 });
                        animateVisitorCount(1);
                    } else {
                        // 기존 카운터 값 가져오기
                        const newCount = docSnap.data().count + 1;
                        transaction.update(counterRef, { count: newCount });
                        animateVisitorCount(newCount);
                    }
                });
            } catch (e) {
                console.error("Transaction failed: ", e);
                document.getElementById('visitorCount').innerText = 'Error';
            }
        }

        // 방문자 카운트 애니메이션 함수
        function animateVisitorCount(count) {
            const visitorCountElement = document.getElementById('visitorCount');
            visitorCountElement.innerText = count;
            visitorCountElement.classList.add('count-up');
            setTimeout(() => {
                visitorCountElement.classList.remove('count-up');
            }, 300);
        }

        // 페이지 로드 시 방문자 카운터 업데이트
        window.onload = function () {
            updateVisitorCount();
        };
    </script>
</body>

</html>
